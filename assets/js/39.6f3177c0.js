(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{468:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"为什么要使用-monorepo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么要使用-monorepo"}},[s._v("#")]),s._v(" 为什么要使用 monorepo")]),s._v(" "),t("ol",[t("li",[s._v("实现一个存储仓库包含多个项目的代码和静态资源；")]),s._v(" "),t("li",[s._v("场景\n"),t("ol",[t("li",[s._v("依赖 A，项目 B，C 两者需要引用依赖 A，但 A 不能上传 npm 仓库；但要注意两者的引入的版本需统一")])])])]),s._v(" "),t("h3",{attrs:{id:"实践"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[s._v("#")]),s._v(" 实践")]),s._v(" "),t("ol",[t("li",[s._v("初始化")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 pnpm")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" monorepo-demo-ks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" monorepo-demo-ks\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化一个包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" init\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("修改根仓库的 package.json 配置")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  monorepo-demo-ks 的 package.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"preinstall"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npx only-allow pnpm"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 增加 preinstall 命令：仅使用 pnpm 安装包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 外层包发布时，会提醒，避免最外层包发布出去")]),s._v("\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("根仓库下手动添加 pnpm-workspace.yaml（工作空间配置）")])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("packages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"packages/*"')]),s._v("\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("增加文件")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("└─packages\n    ├─test1\n    └─test2\n")])])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("初始化 test1 和 test2 子包")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" init\n")])])]),t("ol",{attrs:{start:"6"}},[t("li",[s._v("修改子包 package.json")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n  // @xxx1/xxx2：xxx1 推荐为根仓库名\n  "name": "@monorepo-demo-ks/test1",\n  // 允许子包发布\n  "publicConfig": {\n    "access": "public"\n  },\n}\n\n')])])]),t("ol",{attrs:{start:"7"}},[t("li",[s._v("子包引用")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -F: 要操作的包或项目")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v(" @monorepo-demo-ks/test2 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" @monorepo-demo-ks/test1\n")])])]),t("ol",{attrs:{start:"8"}},[t("li",[s._v("根仓库安装发包依赖")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @changesets/cli 实现批量发包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -w: 在工作区中安装，例如这个例子项目 xx/xx/monorepo-demo-ks")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @changesets/cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" --save-dev\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 工作目录为工作区")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset init\n")])])]),t("ol",{attrs:{start:"9"}},[t("li",[s._v("发包（未尝试）")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 预发布")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tag 值：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# alpha: 内部测试，不向外发布")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# beta: alpha，有可能增加新功能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rc: 发行候选")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset pre enter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变更版本号")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset version\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset public\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出预发布")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset pre "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正式发布")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset version\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" changeset public\n")])])]),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.bilibili.com/video/BV1Aj411h7F2/?spm_id_from=333.337.top_right_bar_window_history.content.click&vd_source=df4615de9f3157ed911988e6ba673737",target:"_blank",rel:"noopener noreferrer"}},[s._v("如何发布一个 monorepo 的 npm 包？"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);